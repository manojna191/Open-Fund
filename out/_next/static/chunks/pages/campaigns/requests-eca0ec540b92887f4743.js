(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[73],{20559:function(t,e,n){"use strict";n.r(e);var r=n(85893),s=n(809),c=n.n(s),a=n(92447),o=n(74047),u=n(4706),i=n(52700),l=n(8127),d=n(44102),f=n(20775),h=n(26265),p=n(67294),x=n(73657),b=n(3542),v=n(68251),m=n(27904);function w(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function j(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?w(Object(n),!0).forEach((function(e){(0,h.Z)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):w(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function g(t){var e=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=(0,f.Z)(t);if(e){var s=(0,f.Z)(this).constructor;n=Reflect.construct(r,arguments,s)}else n=r.apply(this,arguments);return(0,d.Z)(this,n)}}var Z=function(t){(0,l.Z)(n,t);var e=g(n);function n(t){var r;return(0,o.Z)(this,n),r=e.call(this,t),(0,h.Z)((0,u.Z)(r),"getAccount",(0,a.Z)(c().mark((function t(){var e;return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,b.Z.eth.getAccounts();case 2:if(e=t.sent[0],r.state.account===e){t.next=14;break}return t.t0=r,t.t1=j,t.t2=j({},r.state),t.t3={},t.next=10,b.Z.eth.getAccounts();case 10:t.t4=t.sent[0],t.t5={account:t.t4},t.t6=(0,t.t1)(t.t2,t.t3,t.t5),t.t0.setState.call(t.t0,t.t6);case 14:case"end":return t.stop()}}),t)})))),(0,h.Z)((0,u.Z)(r),"setVoted",function(){var t=(0,a.Z)(c().mark((function t(e){var n,s,a;return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,b.Z.eth.getAccounts();case 2:return n=t.sent[0],s=(0,v.Z)(r.props.address),t.next=6,s.methods.VoteOrnot(e,n).call();case 6:if(a=t.sent,console.log(a),r.state.voted===a){t.next=22;break}return t.t0=r,t.t1=j,t.t2=j({},r.state),t.t3={},t.next=15,s.methods.VoteOrnot(e,n).call();case 15:t.t4=t.sent,t.t5={voted:t.t4},t.t6=(0,t.t1)(t.t2,t.t3,t.t5),t.t0.setState.call(t.t0,t.t6),console.log(r.state.voted,"wefwfe"),t.next=23;break;case 22:console.log(r.state.voted,"wedwefwefwefwe");case 23:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()),(0,h.Z)((0,u.Z)(r),"canVote",(function(){for(var t=r.state.account,e=0;e<r.state.donorsDetail.length;e++)if(t==r.state.donorsDetail[e].donar)return!r.state.voted;return!1})),(0,h.Z)((0,u.Z)(r),"canFinalize",(function(){return r.state.account==r.state.owner})),(0,h.Z)((0,u.Z)(r),"voteButtonHandler",function(){var t=(0,a.Z)(c().mark((function t(e){var n;return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=(0,v.Z)(r.state.address),t.next=3,n.methods.voting(e).send({from:r.state.account});case 3:m.Router.pushRoute("/campaigns/".concat(r.state.address));case 4:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()),(0,h.Z)((0,u.Z)(r),"finalizeButtonHandler",function(){var t=(0,a.Z)(c().mark((function t(e){var n;return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=(0,v.Z)(r.state.address),t.next=3,b.Z.eth.getAccounts()[0];case 3:return t.sent,console.log(r.state.account),console.log("here"),t.next=8,n.methods.finalSubmition(e).send({from:r.state.account});case 8:console.log("ola"),m.Router.pushRoute("/campaigns/".concat(r.state.address));case 10:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()),r.state={requests:r.props.requests,owner:r.props.owner,address:r.props.address,donorsDetail:r.props.donorsDetail,account:"",voted:!1},r.canVote(),r.canFinalize(),r}return(0,i.Z)(n,null,[{key:"getInitialProps",value:function(){var t=(0,a.Z)(c().mark((function t(e){var n,r,s,a,o,u,i,l,d,f;return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=(0,v.Z)(e.query.address),t.next=3,n.methods.owner().call();case 3:return r=t.sent,t.next=6,n.methods.getDonarDetailsLength().call();case 6:s=t.sent,a=[],o=0;case 9:if(!(o<s)){t.next=17;break}return t.next=12,n.methods.donors_details(o).call();case 12:u=t.sent,a.push(u);case 14:o++,t.next=9;break;case 17:return t.next=19,n.methods.getRequestLength().call();case 19:i=t.sent,l=[],d=0;case 22:if(!(d<i)){t.next=30;break}return t.next=25,n.methods.request(d).call();case 25:(f=t.sent).status||l.push({request:f,index:d});case 27:d++,t.next=22;break;case 30:return t.abrupt("return",{requests:l,owner:r,address:e.query.address,donorsDetail:a});case 31:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()}]),(0,i.Z)(n,[{key:"render",value:function(){var t=this;return this.getAccount(),(0,r.jsxs)(x.Z,{children:[(0,r.jsx)("h1",{children:"Pending Requests"}),(0,r.jsx)("hr",{}),(0,r.jsxs)("table",{className:"table table-striped",children:[(0,r.jsx)("thead",{children:(0,r.jsxs)("tr",{children:[(0,r.jsx)("th",{scope:"col",children:"Serial"}),(0,r.jsx)("th",{scope:"col",children:"Reciever's Address"}),(0,r.jsx)("th",{scope:"col",children:"Amount Requested"}),(0,r.jsx)("th",{scope:"col",children:"Reason"}),(0,r.jsx)("th",{scope:"col",children:"Vote Button"}),(0,r.jsx)("th",{scope:"col",children:"Finalize Button"})]})}),(0,r.jsx)("tbody",{children:this.state.requests.map((function(e,n){return t.setVoted(e.index),(0,r.jsxs)("tr",{children:[(0,r.jsx)("th",{scope:"row",children:n+1}),(0,r.jsx)("td",{children:e.request.receiver}),(0,r.jsxs)("td",{children:[b.Z.utils.fromWei(e.request.amount,"ether")," ether"]}),(0,r.jsx)("td",{children:e.request.reason}),(0,r.jsx)("td",{children:t.canVote()?(0,r.jsx)("button",{onClick:function(){t.voteButtonHandler(e.index)},type:"button",className:"container-fluid btn btn-success",children:"Vote"}):(0,r.jsx)("button",{type:"button",className:"container-fluid btn btn-danger",disabled:!0,children:"Can't Vote"})}),(0,r.jsx)("td",{children:t.canFinalize()?(0,r.jsx)("button",{onClick:function(){t.finalizeButtonHandler(e.index)},type:"button",className:"container-fluid btn btn-success",children:"Finalize"}):(0,r.jsx)("button",{type:"button",className:"container-fluid btn btn-danger",disabled:!0,children:"Not the manager (owner)"})})]},n)}))})]}),this.canFinalize()?(0,r.jsx)(m.Link,{route:"/campaigns/".concat(this.state.address,"/requests/new"),children:(0,r.jsx)("button",{type:"button",className:"container-fluid btn btn-success",children:"Make a new request"})}):(0,r.jsx)("button",{type:"button",className:"container-fluid btn btn-danger",disabled:!0,children:"Not the manager (owner)"})]})}}]),n}(p.Component);e.default=Z},19553:function(t,e,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/campaigns/requests",function(){return n(20559)}])}},function(t){t.O(0,[482,773,486,774,888,179],(function(){return e=19553,t(t.s=e);var e}));var e=t.O();_N_E=e}]);